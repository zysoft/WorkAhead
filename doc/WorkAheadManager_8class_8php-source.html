<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Work Ahead: lib/classes/WorkAheadManager.class.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>lib/classes/WorkAheadManager.class.php</h1><a href="WorkAheadManager_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00017"></a><a class="code" href="classWorkAheadManager.html">00017</a> <span class="keyword">class </span><a class="code" href="classWorkAheadManager.html">WorkAheadManager</a> {
<a name="l00018"></a>00018 
<a name="l00023"></a><a class="code" href="classWorkAheadManager.html#4bc7c40d913e73dff3ee8dfd03f37949">00023</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#4bc7c40d913e73dff3ee8dfd03f37949">CONFIG_TYPE_FILE</a> = 0;
<a name="l00024"></a><a class="code" href="classWorkAheadManager.html#91ace56c9584faf14fe75c2d86edb780">00024</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#91ace56c9584faf14fe75c2d86edb780">CONFIG_TYPE_STRING</a> = 1;
<a name="l00025"></a><a class="code" href="classWorkAheadManager.html#7226e60f0b115381203d9d38ec98b567">00025</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#7226e60f0b115381203d9d38ec98b567">CONFIG_TYPE_SIMPLEXML</a> = 2;
<a name="l00026"></a>00026 
<a name="l00031"></a><a class="code" href="classWorkAheadManager.html#93035f205dd1b724511149e1a6cc8ac9">00031</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#93035f205dd1b724511149e1a6cc8ac9">STORAGE_FILE</a> = 0;
<a name="l00032"></a><a class="code" href="classWorkAheadManager.html#6ca3a35852861daaa2045aad732133e6">00032</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#6ca3a35852861daaa2045aad732133e6">STORAGE_JSON</a> = 1;
<a name="l00033"></a><a class="code" href="classWorkAheadManager.html#ed88b2efd17769205c21f6f8a4e8845f">00033</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#ed88b2efd17769205c21f6f8a4e8845f">STORAGE_MYSQL</a> = 2;
<a name="l00034"></a>00034 
<a name="l00039"></a><a class="code" href="classWorkAheadManager.html#d17f74550bc0a545132dd070f9dfb163">00039</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#d17f74550bc0a545132dd070f9dfb163">LOG_MAX_LEVEL</a> = 5;
<a name="l00040"></a><a class="code" href="classWorkAheadManager.html#6eb72825aab8066a32c90c363d3d522c">00040</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#6eb72825aab8066a32c90c363d3d522c">LOG_CONF_LOAD</a> = <span class="stringliteral">'Config loaded'</span>;
<a name="l00041"></a><a class="code" href="classWorkAheadManager.html#e63209d327b9e059118f21b416448dca">00041</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#e63209d327b9e059118f21b416448dca">LOG_CONF_NOT_LOADED</a> = <span class="stringliteral">'Config is not loaded'</span>;
<a name="l00042"></a><a class="code" href="classWorkAheadManager.html#687090708144e7a1646a3ea9202d45d5">00042</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#687090708144e7a1646a3ea9202d45d5">LOG_STATS_AUTOLOAD</a> = <span class="stringliteral">'Stats autoload found'</span>;
<a name="l00043"></a><a class="code" href="classWorkAheadManager.html#a0136031c00230fefe84a6d2f771ad3f">00043</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#a0136031c00230fefe84a6d2f771ad3f">LOG_STATS_AUTOLOAD_START</a> = <span class="stringliteral">'Stats autoload started'</span>;
<a name="l00044"></a><a class="code" href="classWorkAheadManager.html#fc7d1424b3e575d14930ecb763b688ed">00044</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#fc7d1424b3e575d14930ecb763b688ed">LOG_STATS_AUTOLOAD_END</a> = <span class="stringliteral">'Stats autoload finished'</span>;
<a name="l00045"></a><a class="code" href="classWorkAheadManager.html#9425616b4f342ef706ef94ad6de98574">00045</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#9425616b4f342ef706ef94ad6de98574">LOG_STATS_SAVE</a> = <span class="stringliteral">'Stats save'</span>;
<a name="l00046"></a><a class="code" href="classWorkAheadManager.html#c2775f1b345771918647d93d59f6c68f">00046</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#c2775f1b345771918647d93d59f6c68f">LOG_STATS_SAVE_START</a> = <span class="stringliteral">'Stats save started'</span>;
<a name="l00047"></a><a class="code" href="classWorkAheadManager.html#24800b53117b0b351295024a1ffc4995">00047</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#24800b53117b0b351295024a1ffc4995">LOG_STATS_SAVE_END</a> = <span class="stringliteral">'Stats save finished'</span>;
<a name="l00048"></a><a class="code" href="classWorkAheadManager.html#bca9c7bd1af904429125a5bf8a66af90">00048</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#bca9c7bd1af904429125a5bf8a66af90">LOG_VISITED_PAGE</a> = <span class="stringliteral">'Visited page'</span>;
<a name="l00049"></a><a class="code" href="classWorkAheadManager.html#2dee2034667a96f886e20ea57f499c3c">00049</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#2dee2034667a96f886e20ea57f499c3c">LOG_GUESSED_PAGE</a> = <span class="stringliteral">'Guessed next page'</span>;
<a name="l00050"></a><a class="code" href="classWorkAheadManager.html#725c2a63a016c3b3318512bfa4c597a5">00050</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#725c2a63a016c3b3318512bfa4c597a5">LOG_PAGE_NOT_GUESSED</a> = <span class="stringliteral">'Page was not guessed'</span>;
<a name="l00051"></a><a class="code" href="classWorkAheadManager.html#c7b999655380a7a3b83dcc8aa75eb763">00051</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#c7b999655380a7a3b83dcc8aa75eb763">LOG_THREAD_FORK</a> = <span class="stringliteral">'Initiating worker thread'</span>;
<a name="l00052"></a><a class="code" href="classWorkAheadManager.html#f4efeba09d779c1dc8b4f65f67b053f9">00052</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#f4efeba09d779c1dc8b4f65f67b053f9">LOG_THREAD_FORK_START</a> = <span class="stringliteral">'Initiating worker thread start'</span>;
<a name="l00053"></a><a class="code" href="classWorkAheadManager.html#44aeb08f43577b71a80aebf8fa862ad4">00053</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#44aeb08f43577b71a80aebf8fa862ad4">LOG_THREAD_FORK_END</a> = <span class="stringliteral">'Worker thread initiated. Main thread is now continue'</span>;
<a name="l00054"></a><a class="code" href="classWorkAheadManager.html#bb62f27f6a450f9ccf4bbab3ed1ca3c7">00054</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#bb62f27f6a450f9ccf4bbab3ed1ca3c7">LOG_THREAD_FORK_DATA</a> = <span class="stringliteral">"Thread initial data:\n"</span>;
<a name="l00055"></a><a class="code" href="classWorkAheadManager.html#3b315c34f9d7d82406a6505f06074c80">00055</a>         <span class="keyword">const</span> <a class="code" href="classWorkAheadManager.html#3b315c34f9d7d82406a6505f06074c80">LOG_PROBABILITY</a> = <span class="stringliteral">'Next page detected with probability'</span>;
<a name="l00061"></a><a class="code" href="classWorkAheadManager.html#82867d76b6846c684f60fd79d46abfaf">00061</a>         <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="classWorkAheadManager.html#82867d76b6846c684f60fd79d46abfaf">$instance</a> = null;
<a name="l00062"></a>00062 
<a name="l00068"></a><a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">00068</a>         <span class="keyword">private</span> <a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a> = null;
<a name="l00069"></a>00069 
<a name="l00075"></a><a class="code" href="classWorkAheadManager.html#232eaaf7f1f731920e47485afe14a957">00075</a>         <span class="keyword">private</span> <a class="code" href="classWorkAheadManager.html#232eaaf7f1f731920e47485afe14a957">$stats</a> = null;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00083"></a><a class="code" href="classWorkAheadManager.html#56ae2bddc972794471fe9ec2cf26bf93">00083</a>         <span class="keyword">private</span> <a class="code" href="classWorkAheadManager.html#56ae2bddc972794471fe9ec2cf26bf93">$dbQueue</a> = array();
<a name="l00084"></a>00084         
<a name="l00085"></a>00085         
<a name="l00091"></a><a class="code" href="classWorkAheadManager.html#7c283862c9232d9fe0ff573694620545">00091</a>         <span class="keyword">private</span> <a class="code" href="classWorkAheadManager.html#7c283862c9232d9fe0ff573694620545">$dbConnection</a> = null;
<a name="l00092"></a>00092         
<a name="l00098"></a><a class="code" href="classWorkAheadManager.html#747e5249b5035c38cf4c309ab232583c">00098</a>         <span class="keyword">private</span> <a class="code" href="classWorkAheadManager.html#747e5249b5035c38cf4c309ab232583c">$logLevel</a> = 0;
<a name="l00099"></a>00099 
<a name="l00105"></a><a class="code" href="classWorkAheadManager.html#c6458014d256df9d89106d04562058c6">00105</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classWorkAheadManager.html#c6458014d256df9d89106d04562058c6">getInstance</a>() {
<a name="l00106"></a>00106                 <span class="keywordflow">if</span> (self::$instance == null) {
<a name="l00107"></a>00107                         self::$instance = <span class="keyword">new</span> <span class="keyword">self</span>;
<a name="l00108"></a>00108                 }
<a name="l00109"></a>00109                 <span class="keywordflow">return</span> self::$instance;
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111 
<a name="l00116"></a><a class="code" href="classWorkAheadManager.html#b9fb2e73219598691bf3dc74ab3b1835">00116</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#b9fb2e73219598691bf3dc74ab3b1835">__construct</a>() {
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119         
<a name="l00124"></a><a class="code" href="classWorkAheadManager.html#a198792f3c2959c8102704a0a9b28abc">00124</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#a198792f3c2959c8102704a0a9b28abc">__clone</a>() {
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00135"></a><a class="code" href="classWorkAheadManager.html#f4f141b015708c5038b43dfccca1daa9">00135</a>         <span class="keyword">public</span> function <a class="code" href="classWorkAheadManager.html#f4f141b015708c5038b43dfccca1daa9">loadConfig</a>(<a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a>, $noAutoload = <span class="keyword">false</span>) {
<a name="l00136"></a>00136                 $configType = self::CONFIG_TYPE_FILE;
<a name="l00137"></a>00137                 <span class="keywordflow">if</span> (<a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a> instanceof SimpleXMLElement) {
<a name="l00138"></a>00138                         $configType = self::CONFIG_TYPE_SIMPLEXML;
<a name="l00139"></a>00139                 } elseif (strpos(<a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a>, <span class="stringliteral">'&lt;?xml'</span>) !== <span class="keyword">false</span>) {
<a name="l00140"></a>00140                         $configType = self::CONFIG_TYPE_STRING;
<a name="l00141"></a>00141                 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                 <span class="keywordflow">try</span> {
<a name="l00144"></a>00144                         <span class="keywordflow">switch</span> ($configType) {
<a name="l00145"></a>00145                                 <span class="keywordflow">case</span> self::CONFIG_TYPE_SIMPLEXML:
<a name="l00146"></a>00146                                         $this-&gt;config = <a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a>;
<a name="l00147"></a>00147                                         <span class="keywordflow">break</span>;
<a name="l00148"></a>00148                                 <span class="keywordflow">case</span> self::CONFIG_TYPE_STRING:
<a name="l00149"></a>00149                                         $this-&gt;config = <span class="keyword">new</span> SimpleXMLElement(<a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a>);
<a name="l00150"></a>00150                                         <span class="keywordflow">break</span>;
<a name="l00151"></a>00151                                 <span class="keywordflow">case</span> self::CONFIG_TYPE_FILE:
<a name="l00152"></a>00152                                         $this-&gt;config = <span class="keyword">new</span> SimpleXMLElement(file_get_contents(<a class="code" href="classWorkAheadManager.html#b83e86049a7527cf8bb59406a4c8b8ee">$config</a>));
<a name="l00153"></a>00153                                         <span class="keywordflow">break</span>;
<a name="l00154"></a>00154                         }
<a name="l00155"></a>00155                         
<a name="l00156"></a>00156                         $this-&gt;logLevel = $this-&gt;config-&gt;Stats-&gt;Log-&gt;LogLevel;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_CONF_LOAD);
<a name="l00159"></a>00159                         
<a name="l00160"></a>00160                         
<a name="l00161"></a>00161                         
<a name="l00162"></a>00162                         <span class="keywordflow">if</span> ($noAutoload) {
<a name="l00163"></a>00163                                 <span class="keywordflow">return</span>;
<a name="l00164"></a>00164                         }
<a name="l00165"></a>00165                         <span class="comment">// Use autoload if needed</span>
<a name="l00166"></a>00166                         $autoloadStorage = $this-&gt;config-&gt;Stats-&gt;Autoload-&gt;Storage;
<a name="l00167"></a>00167                         <span class="keywordflow">if</span> ($autoloadStorage != <span class="stringliteral">'NONE'</span>) {
<a name="l00168"></a>00168                                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD);
<a name="l00169"></a>00169                                 <span class="keywordflow">switch</span> ($autoloadStorage) {
<a name="l00170"></a>00170                                         <span class="keywordflow">case</span> <span class="stringliteral">'FILE'</span>:
<a name="l00171"></a>00171                                                 $this-&gt;<a class="code" href="classWorkAheadManager.html#b67eda1abd46628d9b4397ee20cb3a01">loadStats</a>(self::STORAGE_FILE, $this-&gt;config-&gt;Stats-&gt;Autoload-&gt;Filename);
<a name="l00172"></a>00172                                                 <span class="keywordflow">break</span>;
<a name="l00173"></a>00173                                         <span class="keywordflow">case</span> <span class="stringliteral">'DATABASE'</span>:
<a name="l00174"></a>00174                                                 $this-&gt;<a class="code" href="classWorkAheadManager.html#b67eda1abd46628d9b4397ee20cb3a01">loadStats</a>(self::STORAGE_MYSQL);
<a name="l00175"></a>00175                                                 <span class="keywordflow">break</span>;
<a name="l00176"></a>00176                                 }
<a name="l00177"></a>00177                         }
<a name="l00178"></a>00178                         
<a name="l00179"></a>00179                 } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00180"></a>00180 
<a name="l00181"></a>00181                 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         
<a name="l00185"></a>00185         
<a name="l00191"></a><a class="code" href="classWorkAheadManager.html#8fe4fb2c5bba3459e7c8e447217a2ede">00191</a>         <span class="keyword">public</span> function <a class="code" href="classWorkAheadManager.html#8fe4fb2c5bba3459e7c8e447217a2ede">getConfig</a>() {
<a name="l00192"></a>00192                 <span class="keywordflow">return</span> $this-&gt;config;
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194         
<a name="l00195"></a>00195 
<a name="l00202"></a><a class="code" href="classWorkAheadManager.html#b67eda1abd46628d9b4397ee20cb3a01">00202</a>         <span class="keyword">public</span> function <a class="code" href="classWorkAheadManager.html#b67eda1abd46628d9b4397ee20cb3a01">loadStats</a>($storageType, $storageData = null) {
<a name="l00203"></a>00203                 <span class="keywordflow">try</span> {
<a name="l00204"></a>00204                         <span class="keywordflow">switch</span> ($storageType) {
<a name="l00205"></a>00205                                 <span class="keywordflow">case</span> self::STORAGE_FILE:
<a name="l00206"></a>00206                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_START,<span class="stringliteral">'Storage:FILE ('</span>.$storageData.<span class="charliteral">')'</span>);
<a name="l00207"></a>00207                                         $this-&gt;stats = unserialize(file_get_contents($storageData));
<a name="l00208"></a>00208                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_END,<span class="stringliteral">'Storage:FILE ('</span>.$storageData.<span class="charliteral">')'</span>);
<a name="l00209"></a>00209                                         <span class="keywordflow">break</span>;
<a name="l00210"></a>00210                                 <span class="keywordflow">case</span> self::STORAGE_JSON:
<a name="l00211"></a>00211                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_START,<span class="stringliteral">'Storage:JSON ('</span>.$storageData.<span class="charliteral">')'</span>);
<a name="l00212"></a>00212                                         $this-&gt;stats = json_decode($storageData);
<a name="l00213"></a>00213                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_END,<span class="stringliteral">'Storage:JSON ('</span>.$storageData.<span class="charliteral">')'</span>);
<a name="l00214"></a>00214                                         <span class="keywordflow">break</span>;
<a name="l00215"></a>00215                                 <span class="keywordflow">case</span> self::STORAGE_MYSQL:
<a name="l00216"></a>00216                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_START,<span class="stringliteral">'Storage:MYSQL'</span>);
<a name="l00217"></a>00217                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#094c615af178db05022d892ae57548ef">loadMySqlStats</a>();
<a name="l00218"></a>00218                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_AUTOLOAD_END,<span class="stringliteral">'Storage:MYSQL'</span>);
<a name="l00219"></a>00219                                         <span class="keywordflow">break</span>;
<a name="l00220"></a>00220                         }
<a name="l00221"></a>00221                 } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00235"></a><a class="code" href="classWorkAheadManager.html#f1d14fa9ddad6714cb69f16080b982b2">00235</a>         <span class="keyword">public</span> function <a class="code" href="classWorkAheadManager.html#f1d14fa9ddad6714cb69f16080b982b2">saveStats</a>($storageType, $fileName = null) {
<a name="l00236"></a>00236                 <span class="keywordflow">try</span> {
<a name="l00237"></a>00237                         <span class="keywordflow">switch</span> ($storageType) {
<a name="l00238"></a>00238                                 <span class="keywordflow">case</span> self::STORAGE_FILE:
<a name="l00239"></a>00239                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_START,<span class="stringliteral">'Storage:FILE ('</span>.$fileName.<span class="charliteral">')'</span>);
<a name="l00240"></a>00240                                         file_put_contents($fileName,serialize($this-&gt;stats));
<a name="l00241"></a>00241                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_END,<span class="stringliteral">'Storage:FILE ('</span>.$fileName.<span class="charliteral">')'</span>);
<a name="l00242"></a>00242                                         <span class="keywordflow">break</span>;
<a name="l00243"></a>00243                                 <span class="keywordflow">case</span> self::STORAGE_JSON:
<a name="l00244"></a>00244                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_START,<span class="stringliteral">'Storage:JSON'</span>);
<a name="l00245"></a>00245                                         <span class="keywordflow">return</span> json_encode($this-&gt;stats);
<a name="l00246"></a>00246                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_END,<span class="stringliteral">'Storage:JSON'</span>);
<a name="l00247"></a>00247                                         <span class="keywordflow">break</span>;
<a name="l00248"></a>00248                                 <span class="keywordflow">case</span> self::STORAGE_MYSQL:
<a name="l00249"></a>00249                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_START,<span class="stringliteral">'Storage:MYSQL'</span>);
<a name="l00250"></a>00250                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#e1a7c67e8f8a401f0d5c2ad60e65700b">saveMySqlStats</a>();
<a name="l00251"></a>00251                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE_END,<span class="stringliteral">'Storage:MYSQL'</span>);
<a name="l00252"></a>00252                                         <span class="keywordflow">break</span>;
<a name="l00253"></a>00253                         }
<a name="l00254"></a>00254                 } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00255"></a>00255                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 
<a name="l00265"></a><a class="code" href="classWorkAheadManager.html#094c615af178db05022d892ae57548ef">00265</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#094c615af178db05022d892ae57548ef">loadMySqlStats</a>(){
<a name="l00266"></a>00266                 $this-&gt;<a class="code" href="classWorkAheadManager.html#53a3f1e1fe9600b220b030846db742d6">checkDbConnect</a>();
<a name="l00267"></a>00267                 $query = <span class="stringliteral">"SELECT * FROM "</span>.$this-&gt;config-&gt;MySql-&gt;table;
<a name="l00268"></a>00268                 $res = mysql_query($query);
<a name="l00269"></a>00269                 $this-&gt;stats = array();
<a name="l00270"></a>00270                 <a class="code" href="classWorkAheadManager.html#232eaaf7f1f731920e47485afe14a957">$stats</a> =&amp; $this-&gt;stats;
<a name="l00271"></a>00271                 
<a name="l00272"></a>00272                 <span class="comment">//Creating stats data array</span>
<a name="l00273"></a>00273                 <span class="keywordflow">while</span> ($row = mysql_fetch_assoc($res)) {
<a name="l00274"></a>00274                         $element =&amp; <a class="code" href="classWorkAheadManager.html#232eaaf7f1f731920e47485afe14a957">$stats</a>[$row[<span class="stringliteral">'sourcePageId'</span>]];
<a name="l00275"></a>00275                         <span class="keywordflow">if</span> (!is_array($element)) {
<a name="l00276"></a>00276                                 $element = array();
<a name="l00277"></a>00277                         }
<a name="l00278"></a>00278                         $element[$row[<span class="stringliteral">'destinationPageId'</span>]] = $row[<span class="stringliteral">'references'</span>];
<a name="l00279"></a>00279                 }
<a name="l00280"></a>00280                 
<a name="l00281"></a>00281                 <span class="comment">//Building totals</span>
<a name="l00282"></a>00282                 <span class="keywordflow">foreach</span> (<a class="code" href="classWorkAheadManager.html#232eaaf7f1f731920e47485afe14a957">$stats</a> as $key =&gt;&amp; $stat) {
<a name="l00283"></a>00283                         $count = 0;
<a name="l00284"></a>00284                         <span class="keywordflow">foreach</span> ($stat as $referal) {
<a name="l00285"></a>00285                                 $count += $referal;
<a name="l00286"></a>00286                         }
<a name="l00287"></a>00287                         $stat[<span class="stringliteral">'PAGE_STATS_TOTAL'</span>] = $count;
<a name="l00288"></a>00288                 }
<a name="l00289"></a>00289                 
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291 
<a name="l00295"></a><a class="code" href="classWorkAheadManager.html#e1a7c67e8f8a401f0d5c2ad60e65700b">00295</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#e1a7c67e8f8a401f0d5c2ad60e65700b">saveMySqlStats</a>(){
<a name="l00296"></a>00296                 $this-&gt;<a class="code" href="classWorkAheadManager.html#53a3f1e1fe9600b220b030846db742d6">checkDbConnect</a>();
<a name="l00297"></a>00297                 <span class="keywordflow">foreach</span> ($this-&gt;dbQueue as $query) {
<a name="l00298"></a>00298                         mysql_query($query, $this-&gt;dbConnection);
<a name="l00299"></a>00299                 }
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00307"></a><a class="code" href="classWorkAheadManager.html#53a3f1e1fe9600b220b030846db742d6">00307</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#53a3f1e1fe9600b220b030846db742d6">checkDbConnect</a>() {
<a name="l00308"></a>00308                 <span class="keywordflow">if</span> ($this-&gt;dbConnection == null) {
<a name="l00309"></a>00309                         $this-&gt;dbConnection = mysql_connect($this-&gt;config-&gt;MySql-&gt;host, $this-&gt;config-&gt;MySql-&gt;username, $this-&gt;config-&gt;MySql-&gt;password);
<a name="l00310"></a>00310                         mysql_select_db($this-&gt;config-&gt;MySql-&gt;database, $this-&gt;dbConnection);
<a name="l00311"></a>00311                 }
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313         
<a name="l00314"></a>00314 
<a name="l00323"></a><a class="code" href="classWorkAheadManager.html#46ee1cfa9e430fc7de3af28fd208d5a1">00323</a>         <span class="keyword">public</span> function <a class="code" href="classWorkAheadManager.html#46ee1cfa9e430fc7de3af28fd208d5a1">pageVisit</a>($visitedPageId, $refererPageId) {
<a name="l00324"></a>00324                 <span class="keywordflow">if</span> (!$this-&gt;config) {
<a name="l00325"></a>00325                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_CONF_NOT_LOADED);
<a name="l00326"></a>00326                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00327"></a>00327                 }
<a name="l00328"></a>00328                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_VISITED_PAGE, <span class="stringliteral">'page id: '</span>.$visitedPageId);
<a name="l00329"></a>00329                 <span class="comment">//Checking for pages Ids to be real</span>
<a name="l00330"></a>00330                 $visited = <span class="keyword">false</span>;
<a name="l00331"></a>00331                 $referer = <span class="keyword">false</span>;
<a name="l00332"></a>00332                 $pages = $this-&gt;config-&gt;LookupMap-&gt;Page;
<a name="l00333"></a>00333                 $needStats = ($this-&gt;stats === null);
<a name="l00334"></a>00334                 <span class="keywordflow">if</span> ($needStats) {
<a name="l00335"></a>00335                         $this-&gt;stats = array();
<a name="l00336"></a>00336                 }
<a name="l00337"></a>00337                 <span class="keywordflow">foreach</span> ($pages as $page) {
<a name="l00338"></a>00338                         $pageId = $page[<span class="stringliteral">'id'</span>];
<a name="l00339"></a>00339                         <span class="keywordflow">if</span> ($pageId == $visitedPageId) {
<a name="l00340"></a>00340                                 $visited = $page;
<a name="l00341"></a>00341                         }
<a name="l00342"></a>00342                         <span class="keywordflow">if</span> ($pageId == $refererPageId) {
<a name="l00343"></a>00343                                 $referer = $page;
<a name="l00344"></a>00344                         }
<a name="l00345"></a>00345                                 
<a name="l00346"></a>00346                         <span class="keywordflow">if</span> ($needStats) {
<a name="l00347"></a>00347                                 $this-&gt;stats[<span class="stringliteral">"{$pageId}"</span>] = array(<span class="stringliteral">'PAGE_STATS_TOTAL'</span> =&gt; 0);
<a name="l00348"></a>00348                                 $statPage =&amp; $this-&gt;stats[<span class="stringliteral">"{$pageId}"</span>];
<a name="l00349"></a>00349                                 <span class="keywordflow">foreach</span> ($page-&gt;Reference as $reference) {
<a name="l00350"></a>00350                                         $refId = $reference[<span class="stringliteral">'targetId'</span>];
<a name="l00351"></a>00351                                         $statPage[<span class="stringliteral">"{$refId}"</span>] = 0;
<a name="l00352"></a>00352                                 }
<a name="l00353"></a>00353                         }
<a name="l00354"></a>00354                 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356                 <span class="keywordflow">if</span> (!($visited &amp;&amp; $referer)) {
<a name="l00357"></a>00357                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00358"></a>00358                 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                 <span class="comment">//Beginning run</span>
<a name="l00361"></a>00361                 $refId = $referer[<span class="stringliteral">'id'</span>];
<a name="l00362"></a>00362                 $visId = $visited[<span class="stringliteral">'id'</span>];
<a name="l00363"></a>00363                 $this-&gt;stats[<span class="stringliteral">"{$visId}"</span>][<span class="stringliteral">'PAGE_STATS_TOTAL'</span>]++;
<a name="l00364"></a>00364                 $this-&gt;stats[<span class="stringliteral">"{$refId}"</span>][<span class="stringliteral">"{$visId}"</span>]++;
<a name="l00365"></a>00365                 $this-&gt;dbQueue[] = <span class="stringliteral">"UPDATE `"</span>.$this-&gt;config-&gt;MySql-&gt;table.<span class="stringliteral">"` SET `references` = `references`+1 WHERE sourcePageId='"</span>.$refId.<span class="stringliteral">"' AND destinationPageId='"</span>.$visId.<span class="stringliteral">"'"</span>;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368                 $nextPage = $this-&gt;<a class="code" href="classWorkAheadManager.html#5d2e71bedbc44fcb119bd923da9a199f">getProbability</a>($visId);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370                 <span class="comment">//Saving stats if they were autoloaded</span>
<a name="l00371"></a>00371                 $autoloadStorage = $this-&gt;config-&gt;Stats-&gt;Autoload-&gt;Storage;
<a name="l00372"></a>00372                 <span class="keywordflow">if</span> ($autoloadStorage != <span class="stringliteral">'NONE'</span>) {
<a name="l00373"></a>00373                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_STATS_SAVE);
<a name="l00374"></a>00374                         <span class="keywordflow">switch</span> ($autoloadStorage) {
<a name="l00375"></a>00375                                 <span class="keywordflow">case</span> <span class="stringliteral">'FILE'</span>:
<a name="l00376"></a>00376                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#f1d14fa9ddad6714cb69f16080b982b2">saveStats</a>(self::STORAGE_FILE, $this-&gt;config-&gt;Stats-&gt;Autoload-&gt;Filename);
<a name="l00377"></a>00377                                         <span class="keywordflow">break</span>;
<a name="l00378"></a>00378                                 <span class="keywordflow">case</span> <span class="stringliteral">'DATABASE'</span>:
<a name="l00379"></a>00379                                         $this-&gt;<a class="code" href="classWorkAheadManager.html#f1d14fa9ddad6714cb69f16080b982b2">saveStats</a>(self::STORAGE_MYSQL);
<a name="l00380"></a>00380                                         <span class="keywordflow">break</span>;
<a name="l00381"></a>00381                         }
<a name="l00382"></a>00382                 }
<a name="l00383"></a>00383                 
<a name="l00384"></a>00384                 
<a name="l00385"></a>00385                 <span class="keywordflow">if</span> ($nextPage === <span class="keyword">false</span>) {
<a name="l00386"></a>00386                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_PAGE_NOT_GUESSED);
<a name="l00387"></a>00387                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00388"></a>00388                 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_GUESSED_PAGE, <span class="stringliteral">'page id: '</span>.$nextPage);
<a name="l00391"></a>00391                 
<a name="l00392"></a>00392                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_THREAD_FORK);
<a name="l00393"></a>00393                 
<a name="l00394"></a>00394                 <span class="comment">//Call string</span>
<a name="l00395"></a>00395                 $callStr = $this-&gt;config-&gt;Php-&gt;CallName . <span class="charliteral">' '</span>.
<a name="l00396"></a>00396                                         $this-&gt;config-&gt;Stats-&gt;Call[<span class="stringliteral">'script'</span>];
<a name="l00397"></a>00397                 <span class="comment">//Env params                    </span>
<a name="l00398"></a>00398                 $env = array();
<a name="l00399"></a>00399                 $pgIdName = $this-&gt;config-&gt;Stats-&gt;Call[<span class="stringliteral">'interpretPageIdAs'</span>];
<a name="l00400"></a>00400                 $env[<span class="stringliteral">"{$pgIdName}"</span>] = $nextPage;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402                 $params =&amp; $this-&gt;config-&gt;Stats-&gt;Call-&gt;Parameter;
<a name="l00403"></a>00403                 
<a name="l00404"></a>00404                 <span class="comment">//Creaing parameters for call string</span>
<a name="l00405"></a>00405                 <span class="keywordflow">foreach</span> ($params as $param) {
<a name="l00406"></a>00406                         $name = <span class="stringliteral">''</span>.$param[<span class="stringliteral">'name'</span>];
<a name="l00407"></a>00407                         $scope = $param[<span class="stringliteral">'scope'</span>];
<a name="l00408"></a>00408                         $interpret = $param[<span class="stringliteral">'interpretAs'</span>];
<a name="l00409"></a>00409                         <span class="keywordflow">if</span> ($scope == <span class="stringliteral">'internal'</span>) {
<a name="l00410"></a>00410                                 $env[<span class="stringliteral">"{$interpret}"</span>] = $name();
<a name="l00411"></a>00411                         } <span class="keywordflow">else</span> {
<a name="l00412"></a>00412                                 
<a name="l00413"></a>00413                                 <span class="keywordflow">switch</span> ($scope) {
<a name="l00414"></a>00414                                         <span class="keywordflow">case</span> <span class="stringliteral">'cookie'</span>:
<a name="l00415"></a>00415                                                 $scope = $_COOKIE;
<a name="l00416"></a>00416                                                 <span class="keywordflow">break</span>;
<a name="l00417"></a>00417                                         <span class="keywordflow">case</span> <span class="stringliteral">'session'</span>: 
<a name="l00418"></a>00418                                                 $scope = $_SESSION;
<a name="l00419"></a>00419                                                 <span class="keywordflow">break</span>;
<a name="l00420"></a>00420                                         <span class="keywordflow">default</span>:
<a name="l00421"></a>00421                                                 $scope = array();
<a name="l00422"></a>00422                                                 <span class="keywordflow">break</span>;
<a name="l00423"></a>00423                                 }
<a name="l00424"></a>00424                                 $env[<span class="stringliteral">"{$interpret}"</span>] = $scope[<span class="stringliteral">"{$name}"</span>];
<a name="l00425"></a>00425                         }
<a name="l00426"></a>00426                 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428                 $cwd = $this-&gt;config-&gt;Stats-&gt;Call[<span class="stringliteral">'callDir'</span>];
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                 <span class="keywordflow">if</span> ($this-&gt;logLevel) {
<a name="l00431"></a>00431                         ob_start();
<a name="l00432"></a>00432                         ob_implicit_flush(0);
<a name="l00433"></a>00433                         echo <span class="stringliteral">'RUN COMMAND='</span>.$callStr.<span class="stringliteral">"\n"</span>;
<a name="l00434"></a>00434                         echo <span class="stringliteral">'INITIAL DIR='</span>.$cwd.<span class="stringliteral">"\n"</span>;
<a name="l00435"></a>00435                         echo <span class="stringliteral">"DATA:\n"</span>;
<a name="l00436"></a>00436                         print_r($env);
<a name="l00437"></a>00437                         $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_THREAD_FORK_DATA, ob_get_clean());
<a name="l00438"></a>00438                 }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440                 <span class="comment">//Running background worker</span>
<a name="l00441"></a>00441                 $descriptspec = array(
<a name="l00442"></a>00442                                                                 0 =&gt; array(<span class="stringliteral">'pty'</span>), 
<a name="l00443"></a>00443                                                                 1 =&gt; array(<span class="stringliteral">'pty'</span>), 
<a name="l00444"></a>00444                                                                 2 =&gt; array(<span class="stringliteral">'pty'</span>)
<a name="l00445"></a>00445                                                         );
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_THREAD_FORK_START);
<a name="l00448"></a>00448                 $process = proc_open($callStr, $descriptspec , $pipes, $cwd, $env);
<a name="l00449"></a>00449                 <span class="keywordflow">if</span> (!is_resource($process)) {
<a name="l00450"></a>00450                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00451"></a>00451                 }
<a name="l00452"></a>00452                 <span class="keywordflow">foreach</span>($pipes as $pipe) {
<a name="l00453"></a>00453                         fclose($pipe);
<a name="l00454"></a>00454                 }
<a name="l00455"></a>00455                 proc_close($process);
<a name="l00456"></a>00456                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_THREAD_FORK_END);
<a name="l00457"></a>00457                 
<a name="l00458"></a>00458                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00469"></a><a class="code" href="classWorkAheadManager.html#5d2e71bedbc44fcb119bd923da9a199f">00469</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#5d2e71bedbc44fcb119bd923da9a199f">getProbability</a>($visitedPageId) {
<a name="l00470"></a>00470 
<a name="l00471"></a>00471                 $followers =&amp; $this-&gt;stats[<span class="stringliteral">"{$visitedPageId}"</span>];
<a name="l00472"></a>00472                 $totals =  $followers[<span class="stringliteral">'PAGE_STATS_TOTAL'</span>];
<a name="l00473"></a>00473         
<a name="l00474"></a>00474                 <span class="comment">//Determining if we need to decrease current page ststs</span>
<a name="l00475"></a>00475                 $needDecrease = ($totals &gt;= $this-&gt;config-&gt;Stats-&gt;Lower-&gt;DecreaseOn);
<a name="l00476"></a>00476                 $decreaseValue =  $this-&gt;config-&gt;Stats-&gt;Lower-&gt;DivideBy;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> ($needDecrease) {
<a name="l00479"></a>00479                         $this-&gt;dbQueue[] = <span class="stringliteral">"UPDATE `"</span>.$this-&gt;config-&gt;MySql-&gt;table.<span class="stringliteral">"` SET `references` = `references`/"</span>.$decreaseValue.<span class="stringliteral">" WHERE sourcePageId='"</span>.$visitedPageId.<span class="stringliteral">"'"</span>;
<a name="l00480"></a>00480                 }
<a name="l00481"></a>00481                 
<a name="l00482"></a>00482                 $nextPage = 0;
<a name="l00483"></a>00483                 $nextProbab = 0;
<a name="l00484"></a>00484                 $minReact = $this-&gt;config-&gt;Stats-&gt;MinProbability;
<a name="l00485"></a>00485                 <span class="keywordflow">foreach</span> ($followers as $key =&gt; &amp;$referer) {
<a name="l00486"></a>00486                         <span class="keywordflow">if</span> ($key == <span class="stringliteral">'PAGE_STATS_TOTAL'</span>) {
<a name="l00487"></a>00487                                 <span class="keywordflow">continue</span>;
<a name="l00488"></a>00488                         }
<a name="l00489"></a>00489                         $probability = ($referer/$totals)*100;
<a name="l00490"></a>00490                         <span class="keywordflow">if</span> ($probability &gt; $minReact) {
<a name="l00491"></a>00491                                 <span class="keywordflow">if</span> ($probability &gt; $nextProbab ) {
<a name="l00492"></a>00492                                         $nextPage = $key;
<a name="l00493"></a>00493                                         $nextProbab = $probability;
<a name="l00494"></a>00494                                 }
<a name="l00495"></a>00495                         }
<a name="l00496"></a>00496                         <span class="comment">//Decrease stats if needed</span>
<a name="l00497"></a>00497                         <span class="keywordflow">if</span> ($needDecrease) {
<a name="l00498"></a>00498                                 $referer = round ($referer / $decreaseValue);
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                         
<a name="l00501"></a>00501                 }
<a name="l00502"></a>00502                 
<a name="l00503"></a>00503                 <span class="comment">//Decrease stats if needed</span>
<a name="l00504"></a>00504                 <span class="keywordflow">if</span> ($needDecrease) {
<a name="l00505"></a>00505                         $followers[<span class="stringliteral">'PAGE_STATS_TOTAL'</span>] = round($totals / $decreaseValue);
<a name="l00506"></a>00506                 }
<a name="l00507"></a>00507                 
<a name="l00508"></a>00508                 <span class="keywordflow">if</span> ($nextPage === 0) {
<a name="l00509"></a>00509                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00510"></a>00510                 }
<a name="l00511"></a>00511                 $this-&gt;<a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>(self::LOG_PROBABILITY, $nextProbab);
<a name="l00512"></a>00512                 <span class="keywordflow">return</span> $nextPage;
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00522"></a><a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">00522</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#c2e30b6071d290a9243bf54613feea4f">logOperation</a>($opString, $params = null) {
<a name="l00523"></a>00523                 <span class="keywordflow">if</span> (!$this-&gt;logLevel) {
<a name="l00524"></a>00524                         <span class="keywordflow">return</span>;
<a name="l00525"></a>00525                 }
<a name="l00526"></a>00526                 
<a name="l00527"></a>00527                 <span class="comment">//We will log iterationaly from lower loglevel to higher</span>
<a name="l00528"></a>00528                 <a class="code" href="classWorkAheadManager.html#747e5249b5035c38cf4c309ab232583c">$logLevel</a> = $this-&gt;logLevel;
<a name="l00529"></a>00529                 <span class="keywordflow">for</span> ($i = 1; $i &lt;= <a class="code" href="classWorkAheadManager.html#747e5249b5035c38cf4c309ab232583c">$logLevel</a>; $i++) {
<a name="l00530"></a>00530                         $funcName = <span class="stringliteral">'logLevel'</span>.$i;
<a name="l00531"></a>00531                         $this-&gt;$funcName($opString, $params);
<a name="l00532"></a>00532                 }
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534 
<a name="l00541"></a><a class="code" href="classWorkAheadManager.html#ab86b9888cd8b772c1e1fdc5a7092653">00541</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#ab86b9888cd8b772c1e1fdc5a7092653">logLevel1</a>($opString, $params = null) {
<a name="l00542"></a>00542                 <span class="keywordflow">switch</span> ($opString) {
<a name="l00543"></a>00543                         <span class="keywordflow">case</span> self::LOG_CONF_LOAD: 
<a name="l00544"></a>00544                         <span class="keywordflow">case</span> self::LOG_STATS_AUTOLOAD: 
<a name="l00545"></a>00545                         <span class="keywordflow">case</span> self::LOG_STATS_SAVE: 
<a name="l00546"></a>00546                         <span class="keywordflow">case</span> self::LOG_VISITED_PAGE:
<a name="l00547"></a>00547                         <span class="keywordflow">case</span> self::LOG_GUESSED_PAGE:
<a name="l00548"></a>00548                         <span class="keywordflow">case</span> self::LOG_PAGE_NOT_GUESSED:
<a name="l00549"></a>00549                         <span class="keywordflow">case</span> self::LOG_THREAD_FORK:
<a name="l00550"></a>00550                         <span class="keywordflow">case</span> self::LOG_CONF_NOT_LOADED: 
<a name="l00551"></a>00551                                 error_log($opString.<span class="charliteral">' '</span>.$params);
<a name="l00552"></a>00552                                 <span class="keywordflow">break</span>;
<a name="l00553"></a>00553                         <span class="keywordflow">default</span>:
<a name="l00554"></a>00554                                 <span class="keywordflow">break</span>;
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         
<a name="l00565"></a><a class="code" href="classWorkAheadManager.html#6802d23a18f26ad3470c6a163a339978">00565</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#6802d23a18f26ad3470c6a163a339978">logLevel2</a>($opString, $params = null) {
<a name="l00566"></a>00566                 <span class="keywordflow">switch</span> ($opString) {
<a name="l00567"></a>00567                         <span class="keywordflow">case</span> self::LOG_STATS_AUTOLOAD_START: 
<a name="l00568"></a>00568                         <span class="keywordflow">case</span> self::LOG_STATS_AUTOLOAD_END: 
<a name="l00569"></a>00569                         <span class="keywordflow">case</span> self::LOG_STATS_SAVE_START:
<a name="l00570"></a>00570                         <span class="keywordflow">case</span> self::LOG_STATS_SAVE_END:
<a name="l00571"></a>00571                         <span class="keywordflow">case</span> self::LOG_THREAD_FORK_START:
<a name="l00572"></a>00572                         <span class="keywordflow">case</span> self::LOG_THREAD_FORK_END:
<a name="l00573"></a>00573                         <span class="keywordflow">case</span> self::LOG_PROBABILITY:
<a name="l00574"></a>00574                                 error_log($opString.<span class="charliteral">' '</span>.$params);
<a name="l00575"></a>00575                                 <span class="keywordflow">break</span>;
<a name="l00576"></a>00576                         <span class="keywordflow">default</span>:
<a name="l00577"></a>00577                                 <span class="keywordflow">break</span>;
<a name="l00578"></a>00578                 }
<a name="l00579"></a>00579                 
<a name="l00580"></a>00580         }
<a name="l00581"></a>00581         
<a name="l00582"></a>00582 
<a name="l00589"></a><a class="code" href="classWorkAheadManager.html#01aa3e628afb8dcdebfdaf299369efdc">00589</a>         <span class="keyword">private</span> function <a class="code" href="classWorkAheadManager.html#01aa3e628afb8dcdebfdaf299369efdc">logLevel3</a>($opString, $params = null) {
<a name="l00590"></a>00590                 <span class="keywordflow">switch</span> ($opString) {
<a name="l00591"></a>00591                         <span class="keywordflow">case</span> self::LOG_THREAD_FORK_DATA:
<a name="l00592"></a>00592                                 error_log($opString.<span class="charliteral">' '</span>.$params);
<a name="l00593"></a>00593                                 <span class="keywordflow">break</span>;
<a name="l00594"></a>00594                         <span class="keywordflow">default</span>:
<a name="l00595"></a>00595                                 <span class="keywordflow">break</span>;
<a name="l00596"></a>00596                 }
<a name="l00597"></a>00597                 
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599         
<a name="l00600"></a>00600         
<a name="l00601"></a>00601         
<a name="l00602"></a>00602 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Oct 28 17:41:04 2008 for Work Ahead by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
